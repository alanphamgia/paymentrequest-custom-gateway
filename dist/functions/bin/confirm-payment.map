{"version":3,"sources":["confirm-payment.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAA,eAAA,gBAAA,QAAA,YAAA,CAAA,CAAA;AACA,IAAA,SAAA,gBAAA,QAAA,MAAA,CAAA,CAAA;AAEA,IAAI,CAAC,QAAQ,GAAR,CAAY,UAAjB,EAA6B;AAC3B,YAAQ,GAAR,CAAY,8BAAZ,IAA8C,GAA9C,CAD2B,CACuB;AACnD;AAED,QAAQ,OAAR,GAAkB,UAChB,KADgB,EAEhB,OAFgB,EAGhB,QAHgB,EAGE;;;;;;AAKZ,kCAAc,KAAK,KAAL,CAAW,MAAM,IAAjB,CAAd;AACA,gCAAY,OAAA,OAAA,EAAZ;AAEA,8BAAU,QAAQ,GAAR,CAAY,OAAZ,IAAuB,yBAAjC;AACA,+BAAW,QAAQ,GAAR,CAAY,GAAZ,IAAmB,MAAM,OAAN,CAAc,MAA5C;AAEW,2BAAA,CAAA,CAAA,CAAA,SAAA,EAAM,aAAA,OAAA,CAClB,UAAO,6CADW,EACoC;AACzD,gCAAQ,MADiD;AAEzD,iCAAS;AACP,2CAAe,YAAU,QAAQ,GAAR,CAAY,YAD9B;AAEP,4CAAgB;AAFT,yBAFgD;AAMzD,8BAAM,KAAK,SAAL,CAAe;AACnB,8CAAkB,YAAY,gBADX;AAEnB,mCAAO,YAAY,KAFA;AAGnB,mCAAO,YAAY,KAHA;AAInB,2CAAe,SAJI;AAKnB,0CAAc,+DALK;AAMnB,mCAAO;AACL,yCAAY,WAAQ,mDAAR,GAA4D;AADnE;AANY,yBAAf;AANmD,qBADpC,CAAN,CAAA;;AAAX,+BAAW,GAAA,IAAA,EAAX;yBAmBF,SAAS,IAAT,OAAA,CAAA,CAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AACY,2BAAA,CAAA,CAAA,CAAA,SAAA,EAAM,SAAS,IAAT,EAAN,CAAA;;AAAR,2BAAQ,GAAA,IAAA,EAAR;AAEN,2BAAA,CAAA,CAAA,CAAA,UAAA,EAAO;AACL,oCAAY,GADP;AAEL,8BAAM,KAAK,SAAL,CAAe,EAAE,IAAI,IAAN,EAAY,WAAW,KAAK,SAA5B,EAAf;AAFD,qBAAP,CAAA;;;;;;AAKH,CAzCD","file":"confirm-payment.map","sourceRoot":"../../../src/functions/bin","sourcesContent":["import { Context, Callback, APIGatewayEvent } from \"aws-lambda\";\nimport fetch from 'node-fetch';\nimport uuid from 'uuid';\n\nif (!process.env.PRODUCTION) {\n  process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '0' // For local development\n}\n\nexports.handler = async function (\n  event: APIGatewayEvent,\n  context: Context,\n  callback: Callback) {\n  interface ConfirmResult {\n    returnUrl: string;\n  }\n\n  const requestBody = JSON.parse(event.body);\n  const paymentId = uuid();\n\n  const API_URL = process.env.API_URL || 'https://localhost:12666';\n  const SITE_URL = process.env.URL || event.headers.origin;\n\n  const response = await fetch(\n    `${API_URL}/api/private/custom-payment-gateway/payment`, {\n    method: 'POST',\n    headers: {\n      Authorization: `Bearer ${process.env.BEARER_TOKEN}`,\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      paymentSessionId: requestBody.paymentSessionId,\n      state: requestBody.state,\n      error: requestBody.error,\n      transactionId: paymentId,\n      instructions: 'Your payment will appear on your statement in the coming days',\n      links: {\n        refunds: `${SITE_URL}/.netlify/functions/refund-payment?transactionId=${paymentId}`,\n      }\n    }),\n  });\n\n  if (response.ok) {\n    const body = (await response.json()) as ConfirmResult;\n\n    return {\n      statusCode: 200,\n      body: JSON.stringify({ ok: true, returnUrl: body.returnUrl })\n    };\n  }\n}"]}