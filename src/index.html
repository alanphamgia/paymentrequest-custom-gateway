<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WHITEPLAN</title>
    <link rel="stylesheet" href="./index.scss">
</head>
<body>
    <div id="root"></div>
</body>

<script>
    var paymentSessionId ="";
    var transactionId ="";

    function getData() {
        // var q = window.location.href;
        // let urlSearchParams = new URLSearchParams(window.location.href);

        var urlstr = 'https://blissful-bose-c44299.netlify.app/index.html?vnp_Amount=150000000&vnp_BankCode=NCB&vnp_BankTranNo=20211011212931&vnp_CardType=ATM&vnp_OrderInfo=test&vnp_PayDate=20211011212928&vnp_ResponseCode=00&vnp_TmnCode=HIA645FI&vnp_TransactionNo=13602133&vnp_TransactionStatus=00&vnp_TxnRef=4f2a8978-1903-4ebb-913e-bd26ff303b4b&vnp_SecureHash=10de4c08d64c063a048240206f2789512f8ef8712287c30f01bd27f83ecbe881a659e162a4f1f1cc9699617f097f349ae2586d92e36d0fc8787c36936a26ecc4';
        let urlSearchParams = new URLSearchParams(urlstr);
        paymentSessionId = urlSearchParams.get('vnp_TxnRef') ;

        transactionId =   urlSearchParams.get('vnp_TransactionNo');

        console.log("paymentSessionId: " + paymentSessionId);
        console.log("transactionId: " + transactionId);
        confirm();
    }

   async function confirm() {
    console.log("running");
    const response = await fetch('/.netlify/functions/confirm-payment', {
      method: 'POST',
      body: JSON.stringify({
        paymentSessionId: paymentSessionId,
        transactionId:  transactionId,
        state: "processed",
      })
    });
    console.log(JSON.stringify(response));
    const body = await response.json();

    window.location.href = body.returnUrl;
  }

  getData();

</script>
</html>